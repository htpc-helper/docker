FROM lsiobase/alpine

# environment settings
ENV HOME="/config" \
    XDG_CONFIG_HOME="/config" \
    XDG_DATA_HOME="/config" \
    FLOWS=flows.json \
    NODE_PATH=/usr/src/node-red/node_modules:/config/node_modules

RUN echo "**** install runtime packages ****" && \
    apk add --no-cache \
	    nodejs \
        git



# add local files
COPY root/ /

RUN echo "**** install node packages ****" && \
    npm install --prefix /usr/src/node-red

RUN echo "**** cleanup ****" && \
    apk del git && \
    rm -rf \
	    /tmp/*

# ports and volumes
EXPOSE 1880
VOLUME /config
